@model MoviesRental.Models.Cart
@{
    ViewData["Title"] = "Checkout";
    decimal totalAmount = ViewBag.TotalAmount;
    decimal tax = totalAmount * 0.10m;
    decimal finalTotal = totalAmount + tax;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-4">
                Checkout
            </h1>
            <p class="text-gray-600 text-lg">Complete your rental order with secure payment</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column - Order & Payment -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Order Summary -->
                <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl border border-white/20 p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-shopping-cart text-blue-500 mr-3"></i>
                        Order Summary
                    </h2>
                    
                    <div class="space-y-4">
                        @foreach (var item in Model.CartItems)
                        {
                            var itemTotal = item.Quantity * item.RentalDays * item.Movie.RentalPrice;
                            
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-200">
                                <div class="flex items-center space-x-4">
                                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-film text-white text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-bold text-gray-900">@item.Movie.Title</h3>
                                        <p class="text-gray-600 text-sm flex items-center mt-1">
                                            <i class="fas fa-tag text-purple-500 mr-2"></i>
                                            @item.Movie.Genre
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <div class="flex items-center space-x-6">
                                        <div class="text-center">
                                            <p class="text-sm text-gray-600">Quantity</p>
                                            <p class="font-semibold text-gray-900">@item.Quantity</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-sm text-gray-600">Days</p>
                                            <p class="font-semibold text-gray-900">@item.RentalDays</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-sm text-gray-600">Total</p>
                                            <p class="font-bold text-green-600 text-lg">@itemTotal.ToString("C2")</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <!-- Delivery Information -->
                <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl border border-white/20 p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-truck text-green-500 mr-3"></i>
                        Delivery Information
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Full Name *</label>
                            <input type="text" id="full-name" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                   placeholder="Enter your full name" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address *</label>
                            <input type="email" id="email" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                   placeholder="your@email.com" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Phone Number *</label>
                            <input type="tel" id="phone" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                   placeholder="+1 (555) 123-4567" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">City *</label>
                            <input type="text" id="city" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                                   placeholder="Enter your city" required>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Full Address *</label>
                        <textarea id="address" rows="3"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 resize-none"
                                  placeholder="Enter your complete address" required></textarea>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ZIP/Postal Code *</label>
                        <input type="text" id="zipcode" 
                               class="w-full md:w-48 px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200"
                               placeholder="12345" required>
                    </div>
                </div>

                <!-- Payment Method -->
                <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl border border-white/20 p-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-credit-card text-purple-500 mr-3"></i>
                        Payment Method
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="payment-methods">
                        <div class="payment-option border-2 border-gray-300 rounded-xl p-4 cursor-pointer hover:border-blue-500 transition-all duration-200" data-method="Credit Card">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-credit-card text-white"></i>
                                </div>
                                <span class="font-semibold text-gray-900">Credit Card</span>
                            </div>
                        </div>
                        
                        <div class="payment-option border-2 border-gray-300 rounded-xl p-4 cursor-pointer hover:border-blue-500 transition-all duration-200" data-method="Debit Card">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-credit-card text-white"></i>
                                </div>
                                <span class="font-semibold text-gray-900">Debit Card</span>
                            </div>
                        </div>
                        
                        <div class="payment-option border-2 border-gray-300 rounded-xl p-4 cursor-pointer hover:border-blue-500 transition-all duration-200" data-method="PayPal">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                                    <i class="fab fa-paypal text-white"></i>
                                </div>
                                <span class="font-semibold text-gray-900">PayPal</span>
                            </div>
                        </div>
                        
                        <div class="payment-option border-2 border-gray-300 rounded-xl p-4 cursor-pointer hover:border-blue-500 transition-all duration-200" data-method="Google Pay">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center">
                                    <i class="fab fa-google text-white"></i>
                                </div>
                                <span class="font-semibold text-gray-900">Google Pay</span>
                            </div>
                        </div>
                        
                        <div class="payment-option border-2 border-gray-300 rounded-xl p-4 cursor-pointer hover:border-blue-500 transition-all duration-200" data-method="Apple Pay">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-black rounded-lg flex items-center justify-center">
                                    <i class="fab fa-apple text-white"></i>
                                </div>
                                <span class="font-semibold text-gray-900">Apple Pay</span>
                            </div>
                        </div>
                        
                        <div class="payment-option border-2 border-gray-300 rounded-xl p-4 cursor-pointer hover:border-blue-500 transition-all duration-200" data-method="UPI">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-mobile-alt text-white"></i>
                                </div>
                                <span class="font-semibold text-gray-900">UPI</span>
                            </div>
                        </div>
                    </div>
                    
                    <input type="hidden" id="payment-method" required>
                </div>
            </div>

            <!-- Right Column - Order Total -->
            <div class="lg:col-span-1">
                <div class="bg-white/80 backdrop-blur-lg rounded-2xl shadow-xl border border-white/20 p-6 sticky top-6">
                    <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-receipt text-green-500 mr-3"></i>
                        Order Total
                    </h2>
                    
                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Subtotal</span>
                            <span class="font-semibold text-gray-900">@totalAmount.ToString("C2")</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Tax (10%)</span>
                            <span class="font-semibold text-gray-900">@tax.ToString("C2")</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Shipping</span>
                            <span class="font-semibold text-green-600">FREE</span>
                        </div>
                        
                        <div class="border-t border-gray-200 pt-3">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-bold text-gray-900">Total</span>
                                <span class="text-2xl font-bold text-green-600">@finalTotal.ToString("C2")</span>
                            </div>
                        </div>
                    </div>

                    <!-- Security Features -->
                    <div class="mb-6 space-y-3">
                        <div class="flex items-center space-x-2 text-green-600">
                            <i class="fas fa-shield-alt"></i>
                            <span class="text-sm font-semibold">Secure Payment</span>
                        </div>
                        <div class="flex items-center space-x-2 text-blue-600">
                            <i class="fas fa-lock"></i>
                            <span class="text-sm font-semibold">SSL Encrypted</span>
                        </div>
                        <div class="flex items-center space-x-2 text-purple-600">
                            <i class="fas fa-user-shield"></i>
                            <span class="text-sm font-semibold">Privacy Protected</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="space-y-3">
                        <button id="pay-now"
                                class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 px-6 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center space-x-2 text-lg"
                                data-total="@finalTotal.ToString("C2")">
                            <i class="fas fa-lock"></i>
                            <span>Pay @finalTotal.ToString("C2")</span>
                        </button>
                        
                        <a href="@Url.Action("Index", "Cart")" 
                           class="w-full bg-white border border-gray-300 text-gray-700 py-3 px-6 rounded-xl font-semibold hover:bg-gray-50 transition-all duration-200 flex items-center justify-center space-x-2">
                            <i class="fas fa-arrow-left"></i>
                            <span>Back to Cart</span>
                        </a>
                    </div>

                    <!-- Trust Badges -->
                    <div class="mt-6 grid grid-cols-3 gap-2 text-center">
                        <div class="p-2 bg-gray-100 rounded-lg">
                            <i class="fas fa-award text-yellow-500 text-sm"></i>
                            <p class="text-xs text-gray-600 mt-1">Guaranteed</p>
                        </div>
                        <div class="p-2 bg-gray-100 rounded-lg">
                            <i class="fas fa-shipping-fast text-blue-500 text-sm"></i>
                            <p class="text-xs text-gray-600 mt-1">Instant</p>
                        </div>
                        <div class="p-2 bg-gray-100 rounded-lg">
                            <i class="fas fa-headset text-green-500 text-sm"></i>
                            <p class="text-xs text-gray-600 mt-1">Support</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let selectedPaymentMethod = '';
        const finalTotal = document.getElementById('pay-now').getAttribute('data-total');
        
        // Payment method selection
        document.querySelectorAll('.payment-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove previous selection
                document.querySelectorAll('.payment-option').forEach(opt => {
                    opt.classList.remove('border-blue-500', 'bg-blue-50');
                    opt.classList.add('border-gray-300');
                });
                
                // Add selection to current
                this.classList.remove('border-gray-300');
                this.classList.add('border-blue-500', 'bg-blue-50');
                
                selectedPaymentMethod = this.dataset.method;
                document.getElementById('payment-method').value = selectedPaymentMethod;
            });
        });

        // Pay Now button
        document.getElementById('pay-now').addEventListener('click', function() {
            const paymentMethod = selectedPaymentMethod;
            const fullName = document.getElementById('full-name').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const address = document.getElementById('address').value.trim();
            const city = document.getElementById('city').value.trim();
            const zipcode = document.getElementById('zipcode').value.trim();

            // Validation
            if (!paymentMethod) {
                alert('Please select a payment method');
                return;
            }

            const requiredFields = [fullName, email, phone, address, city, zipcode];
            if (requiredFields.some(field => !field)) {
                alert('Please fill in all required fields');
                return;
            }

            

            if (confirm(`Confirm payment of ${finalTotal}?\n\nPayment Method: ${paymentMethod}`)) {
                const button = this;
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Processing Payment...</span>';

                const formData = new FormData();
                formData.append('paymentMethod', paymentMethod);
                formData.append('fullName', fullName);
                formData.append('email', email);
                formData.append('phone', phone);
                formData.append('address', address);
                formData.append('city', city);
                formData.append('zipcode', zipcode);

                fetch('/Cart/ProcessPayment', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // Show success message
                        button.innerHTML = '<i class="fas fa-check"></i><span>Payment Successful!</span>';
                        button.classList.remove('from-green-500', 'to-green-600');
                        button.classList.add('from-blue-500', 'to-blue-600');
                        
                        setTimeout(() => {
                            window.location.href = '/MyRentals?paymentId=' + data.paymentId;
                        }, 1500);
                    } else {
                        alert(data.message || 'Payment failed. Please try again.');
                        resetButton(button);
                    }
                })
                .catch(error => {
                    console.error('Payment error:', error);
                    alert('Payment failed. Please check your connection and try again.');
                    resetButton(button);
                });
            }
        });

      

        function resetButton(button) {
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-lock"></i><span>Pay ' + finalTotal + '</span>';
        }

       


        // Auto-format phone number
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                value = value.match(/.{1,3}/g).join('-');
                if (value.length > 12) value = value.substr(0, 12);
            }
            e.target.value = value;
        });
    });
</script>

</body>
</html>

